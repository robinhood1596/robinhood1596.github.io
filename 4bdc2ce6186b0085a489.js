"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function c(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var videoStream=null;function populateCameraDropdown(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=document.getElementById("cameraDropdown"),[4,navigator.mediaDevices.enumerateDevices()];case 1:return t.sent().filter((function(e){return"videoinput"===e.kind})).forEach((function(t,n){var r=document.createElement("option");r.value=t.deviceId,r.text=t.label||"Camera ".concat(n+1),e.appendChild(r)})),[2]}}))}))}function populateResolutionDropdown(){var e=document.getElementById("resolutionDropdown");[{width:640,height:480,label:"VGA"},{width:1280,height:720,label:"HD"},{width:1920,height:1080,label:"Full HD"},{width:3712,height:2784,label:"4K"}].forEach((function(t){var n=document.createElement("option");n.value="".concat(t.width,"x").concat(t.height),n.text="".concat(t.label," (").concat(t.width,"x").concat(t.height,")"),e.appendChild(n)}))}function updateStatus(e){var t=document.getElementById("statusMessage");t&&(t.textContent=e)}function capturePhoto(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,r,a,o,i,c,u,s;return __generator(this,(function(d){switch(d.label){case 0:if((e=document.querySelector("video"))||(e=document.createElement("video"),document.body.appendChild(e)),!(t=document.getElementById("capturePhotoButton")))return console.error("Capture button not found"),[2];if(videoStream)return[3,6];d.label=1;case 1:return d.trys.push([1,5,,6]),n=document.getElementById("cameraDropdown"),r=document.getElementById("resolutionDropdown"),n&&r?(a=n.value,o=r.value.split("x").map(Number),i=o[0],c=o[1],updateStatus("Accessing camera..."),[4,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:a},width:{ideal:i},height:{ideal:c},advanced:[{focusMode:{ideal:"continuous"}}]}})]):(console.error("Dropdowns not found"),[2]);case 2:return u=d.sent(),videoStream=u,e.srcObject=u,[4,e.play()];case 3:return d.sent(),updateStatus("Camera ready. Adjusting focus..."),[4,new Promise((function(e){return setTimeout(e,2e3)}))];case 4:return d.sent(),updateStatus("Ready to capture!"),[3,6];case 5:return s=d.sent(),console.error("Error accessing the camera",s),updateStatus("Error accessing the camera. Please try again."),[3,6];case 6:return t.onclick=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,r;return __generator(this,(function(a){switch(a.label){case 0:if(!videoStream)return[3,6];updateStatus("Capturing photo..."),e=videoStream.getVideoTracks()[0],t=new ImageCapture(e),a.label=1;case 1:return a.trys.push([1,4,,5]),[4,t.takePhoto()];case 2:return[4,blobToDataURL(a.sent())];case 3:return n=a.sent(),console.log("Captured image data URL:",n),insertImageToSlide(n.split(",")[1]),updateStatus("Photo captured and inserted!"),[3,5];case 4:return r=a.sent(),console.error("Error capturing photo",r),updateStatus("Error capturing photo. Please try again."),[3,5];case 5:return[3,7];case 6:console.error("No video stream available"),updateStatus("Camera not ready. Please start the camera first."),a.label=7;case 7:return[2]}}))}))},[2]}}))}))}function blobToDataURL(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){return t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}function stopCamera(){if(videoStream){videoStream.getTracks().forEach((function(e){return e.stop()})),videoStream=null;var e=document.querySelector("video");e&&e.remove(),updateStatus("Camera stopped.")}}function insertImageToSlide(e){Office.context.document.setSelectedDataAsync(e,{coercionType:Office.CoercionType.Image},(function(e){e.status===Office.AsyncResultStatus.Failed?(console.error("Error inserting image: "+e.error.message),updateStatus("Failed to insert image. Please try again.")):(console.log("Image inserted successfully."),updateStatus("Image inserted successfully!"))}))}Office.onReady((function(){var e=document.getElementById("capturePhotoButton");e&&e.addEventListener("click",capturePhoto);var t=document.createElement("button");t.textContent="Stop Camera",document.body.appendChild(t),t.addEventListener("click",stopCamera);var n=document.createElement("select");n.id="cameraDropdown",document.body.appendChild(n),populateCameraDropdown();var r=document.createElement("select");r.id="resolutionDropdown",document.body.appendChild(r),populateResolutionDropdown();var a=document.createElement("div");a.id="statusMessage",document.body.appendChild(a)}));