"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function u(e){try{s(n.next(e))}catch(e){a(e)}}function c(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,c)}s((n=n.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=c(0),u.throw=c(1),u.return=c(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var videoStream=null;function populateCameraDropdown(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=document.getElementById("cameraDropdown"),[4,navigator.mediaDevices.enumerateDevices()];case 1:return t.sent().filter((function(e){return"videoinput"===e.kind})).forEach((function(t,r){var n=document.createElement("option");n.value=t.deviceId,n.text=t.label||"Camera ".concat(r+1),e.appendChild(n)})),[2]}}))}))}function populateResolutionDropdown(){var e=document.getElementById("resolutionDropdown");[{width:640,height:480,label:"VGA"},{width:1280,height:720,label:"HD"},{width:1920,height:1080,label:"Full HD"},{width:3712,height:2784,label:"4K"}].forEach((function(t){var r=document.createElement("option");r.value="".concat(t.width,"x").concat(t.height),r.text="".concat(t.label," (").concat(t.width,"x").concat(t.height,")"),e.appendChild(r)}))}function updateStatus(e){var t=document.getElementById("statusMessage");t&&(t.textContent=e)}function supportsAutoFocus(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){return[2,(t=e.getCapabilities()).focusMode&&Array.isArray(t.focusMode)&&t.focusMode.includes("continuous")]}))}))}function setAutoFocus(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:if(t=e.getCapabilities(),e.getSettings(),!(t.focusMode&&Array.isArray(t.focusMode)&&t.focusMode.includes("continuous")))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.applyConstraints({advanced:[{focusMode:"continuous"}]})];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),console.warn("Failed to set auto-focus:",r),[3,4];case 4:return[2]}}))}))}function capturePhoto(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n,o,a,u,c,s,i,d,l,p,f;return __generator(this,(function(m){switch(m.label){case 0:if((e=document.querySelector("video"))||(e=document.createElement("video"),document.body.appendChild(e)),!(t=document.getElementById("capturePhotoButton")))return console.error("Capture button not found"),[2];if(videoStream)return[3,16];m.label=1;case 1:return m.trys.push([1,15,,16]),r=document.getElementById("cameraDropdown"),n=document.getElementById("resolutionDropdown"),r&&n?(o=r.value,a=n.value.split("x").map(Number),u=a[0],c=a[1],updateStatus("Accessing camera..."),[4,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:o},width:{ideal:u},height:{ideal:c},advanced:[{focusMode:{ideal:"continuous"}}]}})]):(console.error("Dropdowns not found"),[2]);case 2:return s=m.sent(),videoStream=s,e.srcObject=s,[4,e.play()];case 3:m.sent(),i=videoStream.getVideoTracks()[0],d=!1,m.label=4;case 4:return m.trys.push([4,6,,7]),[4,supportsAutoFocus(i)];case 5:return d=m.sent(),[3,7];case 6:return l=m.sent(),console.warn("Error checking auto-focus support:",l),[3,7];case 7:if(!d)return[3,13];updateStatus("Camera ready. Adjusting focus..."),m.label=8;case 8:return m.trys.push([8,11,,12]),[4,setAutoFocus(i)];case 9:return m.sent(),[4,new Promise((function(e){return setTimeout(e,2e3)}))];case 10:return m.sent(),updateStatus("Auto-focus set. Ready to capture!"),[3,12];case 11:return p=m.sent(),console.warn("Error setting auto-focus:",p),updateStatus("Auto-focus not available. Ready to capture!"),[3,12];case 12:return[3,14];case 13:updateStatus("Auto-focus not supported. Ready to capture!"),m.label=14;case 14:return[3,16];case 15:return f=m.sent(),console.error("Error accessing the camera",f),updateStatus("Error accessing the camera. Please try again."),[3,16];case 16:return t.onclick=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n;return __generator(this,(function(o){switch(o.label){case 0:if(!videoStream)return[3,6];updateStatus("Capturing photo..."),e=videoStream.getVideoTracks()[0],t=new ImageCapture(e),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,t.takePhoto()];case 2:return[4,blobToDataURL(o.sent())];case 3:return r=o.sent(),console.log("Captured image data URL:",r),insertImageToSlide(r.split(",")[1]),updateStatus("Photo captured and inserted!"),[3,5];case 4:return n=o.sent(),console.error("Error capturing photo",n),updateStatus("Error capturing photo. Please try again."),[3,5];case 5:return[3,7];case 6:console.error("No video stream available"),updateStatus("Camera not ready. Please start the camera first."),o.label=7;case 7:return[2]}}))}))},[2]}}))}))}function blobToDataURL(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=r,n.readAsDataURL(e)}))}function stopCamera(){if(videoStream){videoStream.getTracks().forEach((function(e){return e.stop()})),videoStream=null;var e=document.querySelector("video");e&&e.remove(),updateStatus("Camera stopped.")}}function insertImageToSlide(e){Office.context.document.setSelectedDataAsync(e,{coercionType:Office.CoercionType.Image},(function(e){e.status===Office.AsyncResultStatus.Failed?(console.error("Error inserting image: "+e.error.message),updateStatus("Failed to insert image. Please try again.")):(console.log("Image inserted successfully."),updateStatus("Image inserted successfully!"))}))}Office.onReady((function(){var e=document.getElementById("capturePhotoButton");e&&e.addEventListener("click",capturePhoto);var t=document.createElement("button");t.textContent="Stop Camera",document.body.appendChild(t),t.addEventListener("click",stopCamera);var r=document.createElement("select");r.id="cameraDropdown",document.body.appendChild(r),populateCameraDropdown();var n=document.createElement("select");n.id="resolutionDropdown",document.body.appendChild(n),populateResolutionDropdown();var o=document.createElement("div");o.id="statusMessage",document.body.appendChild(o)}));