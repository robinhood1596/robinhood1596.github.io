"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(o,n){function u(e){try{c(a.next(e))}catch(e){n(e)}}function s(e){try{c(a.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,s)}c((a=a.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,a,o,n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=s(0),u.throw=s(1),u.return=s(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(n=0)),n;)try{if(r=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,a=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(!((o=(o=n.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],a=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var videoStream=null;function populateCameraDropdown(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=document.getElementById("cameraDropdown"),[4,navigator.mediaDevices.enumerateDevices()];case 1:return t.sent().filter((function(e){return"videoinput"===e.kind})).forEach((function(t,r){var a=document.createElement("option");a.value=t.deviceId,a.text=t.label||"Camera ".concat(r+1),e.appendChild(a)})),[2]}}))}))}function populateResolutionDropdown(){var e=document.getElementById("resolutionDropdown");[{width:640,height:480,label:"VGA"},{width:1280,height:720,label:"HD"},{width:1920,height:1080,label:"Full HD"},{width:3712,height:2784,label:"4K"}].forEach((function(t){var r=document.createElement("option");r.value="".concat(t.width,"x").concat(t.height),r.text="".concat(t.label," (").concat(t.width,"x").concat(t.height,")"),e.appendChild(r)}))}function updateStatus(e){var t=document.getElementById("statusMessage");t&&(t.textContent=e)}function supportsAutoFocus(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){return[2,(t=e.getCapabilities()).focusMode&&Array.isArray(t.focusMode)&&t.focusMode.includes("continuous")]}))}))}function setAutoFocus(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(a){switch(a.label){case 0:if(t=e.getCapabilities(),e.getSettings(),!(t.focusMode&&Array.isArray(t.focusMode)&&t.focusMode.includes("continuous")))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.applyConstraints({advanced:[{focusMode:"continuous"}]})];case 2:return a.sent(),[3,4];case 3:return r=a.sent(),console.warn("Failed to set auto-focus:",r),[3,4];case 4:return[2]}}))}))}function capturePhoto(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,a,o,n,u,s,c,i,d,l,p,f,m,h;return __generator(this,(function(v){switch(v.label){case 0:if((e=document.querySelector("video"))||(e=document.createElement("video"),document.body.appendChild(e)),!document.getElementById("capturePhotoButton"))return console.error("Capture button not found"),[2];if(videoStream)return[3,16];v.label=1;case 1:return v.trys.push([1,15,,16]),t=document.getElementById("cameraDropdown"),r=document.getElementById("resolutionDropdown"),t&&r?(a=t.value,o=r.value.split("x").map(Number),n=o[0],u=o[1],updateStatus("Accessing camera..."),[4,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:a},width:{ideal:n},height:{ideal:u},advanced:[{focusMode:{ideal:"continuous"}}]}})]):(console.error("Dropdowns not found"),[2]);case 2:return s=v.sent(),videoStream=s,e.srcObject=s,[4,e.play()];case 3:v.sent(),p=videoStream.getVideoTracks()[0],c=!1,v.label=4;case 4:return v.trys.push([4,6,,7]),[4,supportsAutoFocus(p)];case 5:return c=v.sent(),[3,7];case 6:return i=v.sent(),console.warn("Error checking auto-focus support:",i),[3,7];case 7:if(!c)return[3,13];updateStatus("Camera ready. Adjusting focus..."),v.label=8;case 8:return v.trys.push([8,11,,12]),[4,setAutoFocus(p)];case 9:return v.sent(),[4,new Promise((function(e){return setTimeout(e,2e3)}))];case 10:return v.sent(),updateStatus("Auto-focus set. Ready to capture!"),[3,12];case 11:return d=v.sent(),console.warn("Error setting auto-focus:",d),updateStatus("Auto-focus not available. Ready to capture!"),[3,12];case 12:return[3,14];case 13:updateStatus("Auto-focus not supported. Ready to capture!"),v.label=14;case 14:return[3,16];case 15:return l=v.sent(),console.error("Error accessing the camera",l),updateStatus("Error accessing the camera. Please try again."),[3,16];case 16:if(!videoStream)return[3,22];updateStatus("Capturing photo..."),p=videoStream.getVideoTracks()[0],f=new ImageCapture(p),v.label=17;case 17:return v.trys.push([17,20,,21]),[4,f.takePhoto()];case 18:return[4,blobToDataURL(v.sent())];case 19:return m=v.sent(),console.log("Captured image data URL:",m),insertImageToSlide(m.split(",")[1]),updateStatus("Photo captured and inserted!"),[3,21];case 20:return h=v.sent(),console.error("Error capturing photo",h),updateStatus("Error capturing photo. Please try again."),[3,21];case 21:return[3,23];case 22:console.error("No video stream available"),updateStatus("Camera not ready. Please start the camera first."),v.label=23;case 23:return[2]}}))}))}function blobToDataURL(e){return new Promise((function(t,r){var a=new FileReader;a.onload=function(){return t(a.result)},a.onerror=r,a.readAsDataURL(e)}))}function stopCamera(){if(videoStream){videoStream.getTracks().forEach((function(e){return e.stop()})),videoStream=null;var e=document.querySelector("video");e&&e.remove(),updateStatus("Camera stopped.")}}function readjustFocus(){return __awaiter(this,void 0,void 0,(function(){var e,t,r;return __generator(this,(function(a){switch(a.label){case 0:if(!videoStream)return[3,8];if(e=videoStream.getVideoTracks()[0],!(t=e.getCapabilities()).focusMode||!t.focusMode.includes("continuous"))return[3,6];updateStatus("Readjusting focus..."),a.label=1;case 1:return a.trys.push([1,4,,5]),[4,setAutoFocus(e)];case 2:return a.sent(),[4,new Promise((function(e){return setTimeout(e,2e3)}))];case 3:return a.sent(),updateStatus("Focus readjusted!"),[3,5];case 4:return r=a.sent(),console.warn("Error readjusting focus:",r),updateStatus("Failed to readjust focus. Please try again."),[3,5];case 5:return[3,7];case 6:updateStatus("This camera does not support focus adjustment."),a.label=7;case 7:return[3,9];case 8:console.error("No video stream available"),updateStatus("Camera not ready. Please start the camera first."),a.label=9;case 9:return[2]}}))}))}function insertImageToSlide(e){Office.context.document.setSelectedDataAsync(e,{coercionType:Office.CoercionType.Image},(function(e){e.status===Office.AsyncResultStatus.Failed?(console.error("Error inserting image: "+e.error.message),updateStatus("Failed to insert image. Please try again.")):(console.log("Image inserted successfully."),updateStatus("Image inserted successfully!"))}))}Office.onReady((function(){var e=document.getElementById("capturePhotoButton");e&&e.addEventListener("click",capturePhoto);var t=document.getElementById("stopCameraButton");t&&t.addEventListener("click",stopCamera);var r=document.createElement("button");r.textContent="Readjust Focus",r.id="readjustFocusButton",document.body.appendChild(r),r.addEventListener("click",readjustFocus);var a=document.createElement("select");a.id="cameraDropdown",document.body.appendChild(a),populateCameraDropdown();var o=document.createElement("select");o.id="resolutionDropdown",document.body.appendChild(o),populateResolutionDropdown();var n=document.createElement("div");n.id="statusMessage",document.body.appendChild(n)}));